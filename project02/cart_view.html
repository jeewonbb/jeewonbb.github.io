<!DOCTYPE html>
<html lang="ko">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<title>째깍악어 공식 홈페이지</title>
<link href="css/slick.css" rel="stylesheet" type="text/css">
<link href="css/style.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/slick.min.js"></script>
</head>
<body>
<div class="container cart_view"><!--container S-->
    <div class="in_box"><!--in_box S-->
        <div class="cart_table">
            <form method="POST" id="move_form" name="move_form">
            <p>장바구니</p>

            <ul class="cart_list">
                <li>
                    <div class="checkbox">
                        <input type="checkbox" name="all_chk" id="all_chk">
                        <label for="all_chk">전체선택</label>
                    </div>
                    <div class="del_btn">삭제 (<span class="num">0</span>)</div>
                </li>
                <li>
                    <div class="checkbox">
                        <input type="text" value="9000" name="unit_sale_price">
                        <input type="checkbox" name="item_chk" id="item_chk0" at="218-330-1">
                        <label for="item_chk0"></label></div><div class="item_detail">
                            <img src="img/16101613449847672835_.jpg">
                            <p class="name"><strong>째깍이 가방걸이 인형</strong></p>
                            <p class="txt">ONE SIZE 세로길이 12CM</p>
                        </div>
                        <div class="opt_info">
                            <p style="display: none"><strong class="price_unit">9000</strong>원</p>
                            <div style="display: none"><strong class="price_sale_unit">9000</strong>원</div>
                            <div class="price_btn">
                                <input type="button" value="-" class="minus_btn" at="218-330-1">
                                <input type="text" value="1" class="number" readonly="">
                                <input type="button" value="+" class="plus_btn" at="218-330-1">
                            </div>
                            <div class="total_p">
                                <strong class="sale_price_amount" style="display:none;">9,000원</strong>
                                <strong class="price_amount">9,000</strong>원<span class="del_li_btn" at="218-330-1">
                                    <img src="img/btn_del_circle.svg"></span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="checkbox">
                                <input type="text" value="9000" name="unit_sale_price">
                                <input type="checkbox" name="item_chk" id="item_chk1" at="220-332-1">
                                <label for="item_chk1"></label>
                            </div>
                            <div class="item_detail">
                                <img src="img/59341613451687081650_.jpg">
                                <p class="name"><strong>톡톡이 가방걸이 인형</strong></p>
                                <p class="txt">ONE SIZE 세로길이 12CM</p>
                            </div>
                            <div class="opt_info">
                                <p style="display: none"><strong class="price_unit">9000</strong>원</p>
                                <div style="display: none"><strong class="price_sale_unit">9000</strong>원
                            </div>
                            <div class="price_btn">
                                <input type="button" value="-" class="minus_btn" at="220-332-1">
                                <input type="text" value="1" class="number" readonly="">
                                <input type="button" value="+" class="plus_btn" at="220-332-1">
                            </div>
                            <div class="total_p">
                                <strong class="sale_price_amount" style="display:none;">9,000원</strong>
                                <strong class="price_amount">9,000</strong>원
                                <span class="del_li_btn" at="220-332-1"><img src="img/btn_del_circle.svg"></span>
                            </div>
                        </div>
                    </li>
                </ul>

            <div class="cart_total_area">
                <p>결제 정보</p>

                <div class="cart_total_price">
                    <div><p>상품금액</p> <p><strong class="item_price">18,000</strong>원</p> <span class="plus_ic"></span></div>
                    <div><p>배송비</p> <p><strong class="delivery_price">3,000</strong>원</p> <span class="equal_ic"></span></div>
                    <div><p>총 결제금액</p> <p class="color-red"><strong class="total_price ">21,000</strong>원</p></div>
                </div>
            </div>

            <div class="btn_box">
                <button type="button" class="btn wh-btn">계속 쇼핑하기</button>
                <a href="javascript:;" class="btn black-btn buy_next">구매하기</a>
            </div>
            </form>
        </div>
    </div><!--in_box E-->
</div><!--container E-->

<script>
$(document).ready(function(){
        //전체 선택 클릭시
        $('#all_chk').change(function () {
            if($("#all_chk").is(":checked")){
                $("input[name=item_chk]").prop("checked",true);
            }else{
                $("input[name=item_chk]").prop("checked",false);
            }
            // 전체 체크 순회(체크 확인)
            var check_cnt=0;
            $("input:checkbox[name=item_chk]").each(function() {
                if($("input:checkbox[name=item_chk]").is(":checked") == true){
                    check_cnt++;
                    //console.log(check_cnt)
                }
            });
            $('.del_btn .num').text(check_cnt);
        });

        $(document).on("click","input:checkbox[name='item_chk']",function(){

            var itemLength = $('input[name="item_chk"]').length;
            var checkedLength = $('input[name="item_chk"]:checked').length;
            var selectAll = (itemLength == checkedLength);
            //console.log(checkedLength);

            $('.del_btn .num').text(checkedLength);
            $('#all_chk').prop('checked', selectAll);

        });


        $(document).on("click",".price_btn input[type='button']",function(){
            var $ths = $(this);
            var $par = $ths.parent().parent();
            var $obj = $par.find('input[type="text"]');
            var val = $obj.val();
            if ($ths.val()=='-') {
                if (val > 1)
                    $obj.val(--val);
            }
            else if ($ths.val()=='+') {
                if (val < 30)
                    $obj.val(++val);
            }

            //수량 변경
            var unit_amount=$par.find('.price_unit').text().replace(/[^0-9]/g,"");
            var unit_sale_amount=$par.find('.price_sale_unit').text().replace(/[^0-9]/g,"");
            var quantity = val;
            //console.log("unit_sale_amount : "+unit_sale_amount);
            pay_unit_func($par,unit_amount,quantity);
            pay_sale_unit_func($par,unit_sale_amount,quantity);

            var at = $(this).attr("at");

            $("#gift_card_cnt_"+at).val(quantity);

            //하단 결제정보
            pay_total_func();
        });

        function pay_unit_func($par,unit_amount,quantity){
            var unit_total_amount=$par.find('.price_amount').text((unit_amount*quantity).toLocaleString());
            //console.log("unit_amount : "+unit_amount+"/"+quantity);
        }

        function pay_sale_unit_func($par,unit_sale_amount,quantity){
            var unit_sale_total_amount=$par.find('.sale_price_amount').text((unit_sale_amount*quantity).toLocaleString());
            console.log("unit_sale_amount : "+unit_sale_amount+"/"+quantity);
        }

        function pay_total_func(){
            //하단 결제정보
            var amount_total=0;
            var converse_unit=0;
            var sale_amount_total=0;
            var sale_converse_unit=0;
            $('.cart_list li').each(function() {
                //console.log($(this).find('.price_amount').text());
                converse_unit=$(this).find('.price_amount').text().replace(/[^0-9]/g,"");
                amount_total=amount_total+(parseInt(converse_unit)|| 0);
                sale_converse_unit=$(this).find('.sale_price_amount').text().replace(/[^0-9]/g,"");
                sale_amount_total=sale_amount_total+(parseInt(sale_converse_unit)|| 0);
                //총 상품금액
                //console.log(amount_total);
            });
            //총 상품금액
            //var total_amount_money = $('.cart_total_price').children().find('.item_price').text();
            var total_amount_money =$('.cart_total_price').children().find('.item_price').text(amount_total.toLocaleString());
            //할인금액

            var total_sale_money =  $('.cart_total_price').children().find('.sale_price').text(sale_amount_total.toLocaleString());

            total_sale_money = parseInt($('.cart_total_price').children().find('.sale_price').text().replace(/[^0-9]/g,"")|| 0);
            //console.log("total_sale_money : "+total_sale_money);
            //총 배송비


            var total_delivery_price = parseInt($('.cart_total_price').children().find('.delivery_price').text().replace(/[^0-9]/g,"")|| 0);
            //배송비 계산
            if(parseInt(amount_total)<30000){
                $('.delivery_price').text("3,000");
            }else{
                $('.delivery_price').text("0");
                total_delivery_price = 0;
            }
            console.log(amount_total+"/////"+total_sale_money);
            //console.log(total_delivery_price);
            //총 결제금액
            var total_price=(parseInt(amount_total|| 0)-total_sale_money+total_delivery_price);

            var total_total_price = $('.cart_total_price').children().find('.total_price').text(total_price.toLocaleString());
        }

        //개별 아이템 삭제
        $(document).on("click",".del_li_btn",function(){
            var recent_delete_cnt=$('.del_btn .num').text();
            var at = $(this).attr("at");
            var check_delete_ck=$(this).offsetParent().parent().find('input[type="checkbox"]').is(':checked');
            console.log(check_delete_ck);
            if(check_delete_ck == true){
                recent_delete_cnt=recent_delete_cnt - 1;
                $('.del_btn .num').text(recent_delete_cnt);
            }
            $(this).offsetParent().parent().remove();
            //console.log($(this).offsetParent().parents().find('input[type="checkbox"]').is(':checked'));
            pay_total_func();
            basket_del(at);
        });
        //삭제 버튼을 누르면 지정된 상품 삭제
        $('.del_btn').on('click', function(){
            var recent_delete_cnt=$('.del_btn .num').text();
            var at="";
            $("input:checkbox[name=item_chk]").each(function() {
                var check_delete_ck=$(this).offsetParent().find('input[type="checkbox"]').is(':checked');
                console.log(check_delete_ck);
                if(check_delete_ck == true){
                    at += $(this).attr("at")+",";
                    recent_delete_cnt=recent_delete_cnt - 1;
                    $('.del_btn .num').text(recent_delete_cnt);
                    $(this).offsetParent().remove();

                }
            });
            pay_total_func();
            at = at.substr(0, at.length -1);
            //alert("삭제할것 : "+at);
            basket_del(at);
        });
    });

</script>

</body>
<!-- End Body -->
</html>


